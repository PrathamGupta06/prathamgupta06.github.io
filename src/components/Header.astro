---
import logoStar from "../assets/logo-star.svg";

import { author, buy } from "../sample";

const links = [
  { name: "About", path: "/#", target: "_self", section: "hero" },
  {
    name: "Experience",
    path: "/#experience",
    target: "_self",
    section: "experience",
  },
  {
    name: "Projects",
    path: "/#projects",
    target: "_self",
    section: "projects",
  },
  {
    name: "Achievements",
    path: "/#achievements",
    target: "_self",
    section: "achievements",
  },
  {
    name: "Education",
    path: "/#education",
    target: "_self",
    section: "education",
  },
  { name: "Skills", path: "/#skills", target: "_self", section: "skills" },
  { name: "Contact", path: "/#contact", target: "_self", section: "contact" },
];

const { pathname } = Astro.url;
---

<header
  class="fixed top-0 left-0 right-0 z-50 border-b-3 p-4 md:p-7 overflow-hidden bg-[var(--main-bg)]"
>
  <div
    class="flex border-3 border-black bg-white max-w-[310px] md:max-w-2xl m-auto relative z-10"
  >
    <!-- top boxes -->
    <div class="size-2 bg-white border-2 border-black absolute -top-2 -right-2">
    </div>
    <div class="size-2 bg-white border-2 border-black absolute -top-2 -left-2">
    </div>

    <!-- bottom boxes -->
    <div
      class="size-2 bg-white border-2 border-black absolute -bottom-2 -left-2"
    >
    </div>
    <div
      class="size-2 bg-white border-2 border-black absolute -bottom-2 -right-2"
    >
    </div>

    <nav class="flex w-full items-center p-2 md:p-0">
      <a href="#" class="flex md:hidden" id="menu-open">
        <i class="ri-menu-2-line text-2xl ml-3"></i>
      </a>
      <ul class="hidden md:flex w-full">
        {
          links.map((item) => (
            <li class="border-l-2 border-black p-3 py-4 flex-1 first:border-l-0">
              <a
                href={item.path}
                target={item.target}
                data-section={item.section}
                class="nav-link whitespace-nowrap relative flex items-center justify-center before:absolute before:left-0 before:bottom-1 before:h-[8px] before:w-0 before:bg-[var(--yellow)] before:transition-all before:duration-300 hover:before:w-full"
              >
                <span class="relative z-5">{item.name}</span>
              </a>
            </li>
          ))
        }
      </ul>
    </nav>
  </div>
</header>

<div
  class="block md:hidden fixed left-0 top-0 h-full w-full bg-white z-20 p-3 transition-all duration-300 -translate-x-[100%]"
  id="menu-content"
>
  <div class="flex p-6">
    <h3 class="flex-1 font-bold uppercase">Menu</h3>
    <a href="#" id="menu-close">
      <i class="ri-close-line text-3xl"></i>
    </a>
  </div>
  <ul class="flex flex-col justify-center items-center gap-4 md:hidden">
    {
      links.map((item) => (
        <li class="py-3">
          <a
            href={item.path}
            target={item.target}
            data-section={item.section}
            class="nav-link p-3 whitespace-nowrap text-2xl font-bold"
          >
            {item.name}
          </a>
        </li>
      ))
    }
  </ul>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const menuContent = document.querySelector("#menu-content");
    const menuOpen = document.querySelector("#menu-open");
    const menuClose = document.querySelector("#menu-close");

    // Mobile menu handlers
    menuOpen?.addEventListener("click", (e) => {
      e.preventDefault();
      menuContent?.classList.remove("-translate-x-[100%]");
    });

    menuClose?.addEventListener("click", (e) => {
      e.preventDefault();
      menuContent?.classList.add("-translate-x-[100%]");
    });

    menuContent?.querySelectorAll("li a").forEach((item) => {
      item.addEventListener("click", (e) => {
        menuContent?.classList.add("-translate-x-[100%]");
      });
    });

    // Scroll-based active section highlighting
    const sections = document.querySelectorAll("section[id]");
    const navLinks = document.querySelectorAll(".nav-link");

    function highlightActiveSection() {
      const scrollY = window.scrollY + 100; // Offset for better UX

      sections.forEach((section) => {
        const sectionTop =
          section instanceof HTMLElement ? section.offsetTop : 0;
        const sectionHeight =
          section instanceof HTMLElement ? section.offsetHeight : 0;
        const sectionId = section.getAttribute("id");

        if (scrollY >= sectionTop && scrollY < sectionTop + sectionHeight) {
          navLinks.forEach((link) => {
            const linkSection = link.getAttribute("data-section");
            if (linkSection === sectionId) {
              link.classList.add("active");
            } else {
              link.classList.remove("active");
            }
          });
        }
      });
    }

    window.addEventListener("scroll", highlightActiveSection);
    highlightActiveSection(); // Call on load
  });
</script>

<style>
  .nav-link.active::before {
    width: 100%;
  }

  .nav-link.active span {
    font-weight: 700;
  }

  /* Mobile menu active state */
  #menu-content .nav-link.active {
    color: #000;
    text-decoration: underline;
    text-decoration-color: var(--yellow);
    text-decoration-thickness: 4px;
    text-underline-offset: 6px;
  }
</style>
